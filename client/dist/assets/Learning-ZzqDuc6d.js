import{G as e,H as t,I as s,j as r,p as n,J as i}from"./index-BWr3B_Ui.js";import{b as a,c as l}from"./vendor-BPoNO7EH.js";const c=e=>{const t=e.match(/(?:youtu\.be\/|youtube\.com\/(?:watch\?v=|embed\/))([\w-]{11})/);return t?`https://www.youtube.com/embed/${t[1]}`:null},o=e=>`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`,d=({lecture:n})=>{const{user:i}=t((e=>e.auth)),l=a.useRef(null),d=a.useRef(null),[u,m]=a.useState(0),[h,v]=a.useState(0),[x,p]=a.useState(0),[g,b]=a.useState(!1),[f,j]=a.useState(null),[N,y]=a.useState(!1),{data:w,isLoading:k}=s(null==n?void 0:n.id,{skip:!(null==n?void 0:n.id)}),{startTrackingProgress:S,updateVideoProgress:T,isTracking:_,error:E}=((t,s,r)=>{const[n]=e(),[i,l]=a.useState(!1),[c,o]=a.useState(0),[d,u]=a.useState(null),m=a.useRef(0),h=a.useRef(null),v=!0===(null==r?void 0:r.is_completed),x=a.useCallback((async(e,r,i=!1)=>{if(!v)try{const a=Math.floor(e),l=Math.floor(r);if(!t||!s)return void u("Missing lecture ID or duration");const c=Date.now();if(c-m.current<5e3&&!i)return;const d=a/l*100>=95;await n({lecture_id:t,watch_duration:a,total_duration:l,is_completed:d}),m.current=c,o(a)}catch(a){u(a.message)}}),[t,s,n,v]),p=a.useCallback((e=>{if(v)return;if(!t||!s)return void u("Missing lecture ID or duration");if(l(!0),u(null),"object"==typeof e&&e.isYoutube)return()=>{h.current&&clearInterval(h.current)};if(!(e&&e instanceof HTMLVideoElement))return void u("Invalid video element");const r=()=>{e.paused||x(e.currentTime,e.duration)},n=()=>{x(e.currentTime,e.duration)},i=()=>{x(e.currentTime,e.duration)},a=()=>{x(e.duration,e.duration)};return e.addEventListener("timeupdate",r),e.addEventListener("pause",n),e.addEventListener("seeked",i),e.addEventListener("ended",a),h.current=setInterval((()=>{e.paused||x(e.currentTime,e.duration)}),5e3),()=>{e.removeEventListener("timeupdate",r),e.removeEventListener("pause",n),e.removeEventListener("seeked",i),e.removeEventListener("ended",a),h.current&&clearInterval(h.current),l(!1)}}),[t,s,x,v]);return a.useEffect((()=>()=>{h.current&&clearInterval(h.current)}),[]),{startTrackingProgress:p,updateVideoProgress:x,isTracking:i,lastSavedProgress:c,error:d}})(null==n?void 0:n.id,null==n?void 0:n.duration,w),I=!0===(null==w?void 0:w.is_completed);a.useEffect((()=>{m(0),v(0),p(0),b(!1),j(null),y(!1),d.current&&(d.current.destroy(),d.current=null)}),[null==n?void 0:n.id]),a.useEffect((()=>{E&&j(E)}),[E]),a.useEffect((()=>{var e;if(null==(e=null==n?void 0:n.video_url)?void 0:e.includes("youtu")){y(!0);let e=null;const t=()=>{const t=c(n.video_url);t&&(d.current&&(d.current.destroy(),d.current=null),d.current=new window.YT.Player("youtube-player",{height:"100%",width:"100%",videoId:t.split("/").pop(),playerVars:{playsinline:1,controls:1,rel:0},events:{onReady:e=>{const t=e.target.getDuration();v(t),(null==w?void 0:w.watch_duration)&&(e.target.seekTo(w.watch_duration),m(w.watch_duration),p(w.watch_duration/t*100))},onStateChange:t=>{if(t.data===window.YT.PlayerState.PLAYING)b(!1),e&&clearInterval(e),I||(e=setInterval((()=>{if(d.current){const e=d.current.getCurrentTime(),t=d.current.getDuration();m(e),p(e/t*100),T(e,t,!0)}}),5e3));else if(t.data===window.YT.PlayerState.PAUSED){if(e&&clearInterval(e),d.current&&!I){const e=d.current.getCurrentTime(),t=d.current.getDuration();T(e,t,!0)}}else if(t.data===window.YT.PlayerState.ENDED){if(e&&clearInterval(e),d.current&&!I){const e=d.current.getDuration();T(e,e,!0)}}else t.data===window.YT.PlayerState.BUFFERING&&b(!0)},onError:e=>{j("Error playing YouTube video")}}}))};if(window.YT&&window.YT.Player)t();else{const e=document.createElement("script");e.src="https://www.youtube.com/iframe_api";const s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(e,s),window.onYouTubeIframeAPIReady=t}return()=>{e&&clearInterval(e),d.current&&(d.current.destroy(),d.current=null)}}}),[null==n?void 0:n.video_url,w,T,I]),a.useEffect((()=>{if(l.current&&(null==n?void 0:n.id)&&(null==n?void 0:n.video_url)&&!n.video_url.includes("youtu")&&(null==n?void 0:n.duration)){console.log("[VideoPlayer] Start tracking progress for",null==n?void 0:n.id,null==n?void 0:n.title);return S(l.current)}}),[S,null==n?void 0:n.id,null==n?void 0:n.video_url,null==n?void 0:n.duration]),a.useEffect((()=>{w&&!N&&l.current&&(l.current.currentTime=w.watch_duration,m(w.watch_duration),p(w.watch_duration/w.total_duration*100))}),[w,N]);const L=()=>{if(l.current){const e=l.current.currentTime,t=e/l.current.duration*100;m(e),p(t)}},P=()=>{if(l.current){const e=l.current.duration;v(e)}},$=()=>{b(!0)},M=()=>{b(!1)};return n?n.video_url?n.video_url.includes("youtu")?(c(n.video_url),r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"video-container position-relative bg-dark",style:{minHeight:500,height:500},children:r.jsx("div",{id:"youtube-player",style:{width:"100%",height:"100%"}})}),r.jsxs("div",{className:"bg-dark bg-opacity-75 p-2 mt-0",children:[r.jsxs("div",{className:"d-flex justify-content-between align-items-center text-white mb-1",children:[r.jsxs("small",{children:[o(u)," / ",o(h)]}),r.jsx("small",{children:I?r.jsx("span",{className:"text-success",children:"Completed!"}):g?r.jsx("span",{className:"text-warning",children:"Buffering..."}):`${Math.round(x)}% watched`})]}),r.jsx("div",{className:"progress",style:{height:"4px"},children:r.jsx("div",{className:"progress-bar "+(I?"bg-success":"bg-primary"),role:"progressbar",style:{width:`${x}%`},"aria-valuenow":x,"aria-valuemin":"0","aria-valuemax":"100"})}),_&&!I&&r.jsx("small",{className:"text-success d-block mt-1",children:"Progress is being saved..."}),f&&r.jsxs("small",{className:"text-danger d-block mt-1",children:["Error: ",f]})]})]})):n.video_url?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"video-container position-relative bg-dark",style:{minHeight:400,height:400},children:r.jsxs("video",{ref:l,className:"w-100 h-100",controls:!0,playsInline:!0,controlsList:"nodownload",style:{objectFit:"contain",height:400},onTimeUpdate:L,onLoadedMetadata:P,onWaiting:$,onPlaying:M,children:[r.jsx("source",{src:n.video_url,type:"video/mp4"}),"Your browser does not support the video tag."]},n.id)}),r.jsxs("div",{className:"bg-dark bg-opacity-75 p-2 mt-0",children:[r.jsxs("div",{className:"d-flex justify-content-between align-items-center text-white mb-1",children:[r.jsxs("small",{children:[o(u)," / ",o(h)]}),r.jsx("small",{children:I?r.jsx("span",{className:"text-success",children:"Completed!"}):g?r.jsx("span",{className:"text-warning",children:"Buffering..."}):`${Math.round(x)}% watched`})]}),r.jsx("div",{className:"progress",style:{height:"4px"},children:r.jsx("div",{className:"progress-bar "+(I?"bg-success":"bg-primary"),role:"progressbar",style:{width:`${x}%`},"aria-valuenow":x,"aria-valuemin":"0","aria-valuemax":"100"})}),_&&!I&&r.jsx("small",{className:"text-success d-block mt-1",children:"Progress is being saved..."}),f&&r.jsxs("small",{className:"text-danger d-block mt-1",children:["Error: ",f]})]})]}):r.jsx("div",{className:"video-container position-relative bg-dark",style:{minHeight:400},children:r.jsx("div",{className:"d-flex justify-content-center align-items-center h-100",children:r.jsx("span",{className:"text-white",children:"No video available"})})}):r.jsx("div",{className:"video-container position-relative bg-dark",style:{minHeight:400},children:r.jsx("div",{className:"d-flex justify-content-center align-items-center h-100",children:r.jsx("span",{className:"text-white",children:"No video available for this lecture"})})}):r.jsx("div",{className:"video-container position-relative bg-dark",style:{minHeight:500},children:r.jsx("div",{className:"d-flex justify-content-center align-items-center h-100",children:r.jsx("span",{className:"text-white",children:"No lecture selected"})})})},u=({TABS:e,activeTab:t,setActiveTab:s,renderTabContent:n})=>r.jsxs(r.Fragment,{children:[r.jsx("ul",{className:"nav nav-tabs px-4 border-bottom",style:{background:"#fff"},children:e.map((e=>r.jsx("li",{className:"nav-item",children:r.jsx("button",{className:"nav-link "+(t===e.key?"active":""),onClick:()=>s(e.key),style:{cursor:"pointer"},children:e.label})},e.key)))}),r.jsx("div",{style:{background:"#fff",minHeight:300,borderBottomLeftRadius:8},children:n()})]}),m=({sections:e,expandedSection:t,setExpandedSection:s,selectedLecture:n,setSelectedLecture:i,formatDuration:a,lectureProgressMap:l={}})=>r.jsxs("div",{className:"p-0 h-100 bg-white border-start",style:{maxHeight:"100vh"},children:[r.jsx("div",{className:"px-4 pt-4 pb-2 border-bottom",children:r.jsx("span",{className:"fw-bold fs-6",children:"Course content"})}),r.jsx("div",{className:"overflow-auto",style:{maxHeight:"calc(100vh - 60px)"},children:e.map(((e,c)=>{const o=e.lectures.reduce(((e,t)=>e+(t.duration||0)),0),d=e.lectures.filter((e=>{var t;return!0===(null==(t=l[e.id])?void 0:t.is_completed)})).length;return r.jsxs("div",{className:"border-bottom",children:[r.jsxs("div",{className:"d-flex align-items-center justify-content-between px-4 py-3 bg-white section-title",style:{cursor:"pointer"},onClick:()=>s(t===e.id?null:e.id),children:[r.jsxs("div",{className:"d-flex flex-column",children:[r.jsx("div",{className:"fw-bold",children:`Section ${c+1}: ${e.title}`}),r.jsx("span",{className:"small text-muted",children:`${d} / ${e.lectures.length} | ${a(o)}`})]}),r.jsx("div",{className:"d-flex align-items-center gap-3",children:r.jsx("i",{className:`bi ${t===e.id?"bi-chevron-up":"bi-chevron-down"} text-muted`})})]}),r.jsx("ul",{className:"list-group list-group-flush "+(t===e.id?"show":"collapse"),children:e.lectures.map(((e,t)=>{const s=l[e.id],c=!0===(null==s?void 0:s.is_completed);return r.jsxs("li",{className:"list-group-item d-flex align-items-center justify-content-between px-4 py-2 border-0 "+((null==n?void 0:n.id)===e.id?"bg-primary bg-opacity-10 text-primary":"bg-transparent"),style:{cursor:"pointer",borderRadius:0},onClick:()=>i(e),children:[r.jsxs("div",{className:"d-flex align-items-center gap-2 flex-grow-1",children:[r.jsx("input",{type:"checkbox",className:"form-check-input me-2",style:{pointerEvents:"none"},checked:c,readOnly:!0}),r.jsxs("span",{className:"small text-muted",children:[t+1,"."]}),r.jsx("span",{className:"small fw-semibold ms-1",children:e.title})]}),r.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.resources&&e.resources.length>0&&r.jsxs("div",{className:"dropdown",children:[r.jsx("button",{className:"btn btn-sm btn-outline-secondary dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false",children:"Resources"}),r.jsx("ul",{className:"dropdown-menu",children:e.resources.map(((e,t)=>r.jsx("li",{children:r.jsx("a",{className:"dropdown-item",href:e.url,target:"_blank",rel:"noopener noreferrer",children:e.name})},t)))})]}),r.jsx("span",{className:"small text-muted ms-2",children:a(e.duration)})]})]},e.id)}))})]},e.id)}))})]}),h=e=>{if("number"!=typeof e||isNaN(e)||e<0)return"00:00";const t=Math.floor(e/3600),s=Math.floor(e%3600/60),r=e%60;return t>0?`${t}:${s.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`:`${s.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`},v=[{key:"overview",label:"Overview"},{key:"qa",label:"Q&A"},{key:"notes",label:"Notes"}],x=()=>{const{id:e}=l(),{data:t,isLoading:s,error:c}=n(e),{data:o,isLoading:x}=i(e),[p,g]=a.useState(null),[b,f]=a.useState(null),[j,N]=a.useState("overview"),y=a.useMemo((()=>{if(!o)return{};const e={};return o.forEach((t=>{e[t.lecture_id]=t})),e}),[o]);if(s)return r.jsx("div",{className:"d-flex justify-content-center align-items-center min-vh-100",children:r.jsx("div",{className:"spinner-border text-primary",role:"status",children:r.jsx("span",{className:"visually-hidden",children:"Loading..."})})});if(c)return r.jsx("div",{className:"alert alert-danger m-5 text-center",role:"alert",children:"Error loading course content"});if(!t)return null;let w=null;for(const r of t.sections)if(r.lectures&&r.lectures.length>0){w=r.lectures[0];break}const k=p||w;(e=>{if(!e)return null;const t=e.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#&?]*).*/);t&&11===t[2].length&&t[2]})((null==k?void 0:k.video_url)||t.video_preview);return r.jsxs("div",{className:"container-fluid p-0 bg-light",children:[r.jsx("title",{children:t.title}),r.jsx("meta",{name:"description",content:t.description}),r.jsxs("div",{className:"bg-dark bg-opacity-75 d-flex justify-content-between align-items-center py-2 px-4",children:[r.jsx("h6",{className:"m-0 text-white",children:t.title}),r.jsx("div",{className:"d-flex align-items-center gap-2",children:r.jsxs("button",{className:"btn btn-outline-light",onClick:()=>window.location.href="/user-learning",children:[r.jsx("i",{className:"bi bi-house me-2"}),"Dashboard"]})})]}),r.jsxs("div",{className:"row g-0",children:[r.jsxs("div",{className:"col-lg-8 p-0",style:{minHeight:"100vh",background:"#fff"},children:[r.jsx(d,{lecture:p}),r.jsx(u,{TABS:v,activeTab:j,setActiveTab:N,renderTabContent:()=>{return"overview"===j?r.jsxs("div",{className:"p-4",children:[r.jsx("h5",{className:"fw-bold mb-3",children:t.title}),r.jsxs("div",{className:"mb-2",children:[r.jsx("span",{className:"badge bg-secondary me-2",children:t.category}),r.jsx("span",{className:"badge bg-info",children:t.level})]}),r.jsxs("div",{className:"mb-2 text-muted",children:[r.jsx("i",{className:"bi bi-person-circle me-2"}),t.instructor]}),r.jsxs("div",{className:"mb-2 text-muted",children:[r.jsx("i",{className:"bi bi-clock me-2"}),h(t.duration)]}),r.jsxs("div",{className:"mb-2 text-muted",children:[r.jsx("i",{className:"bi bi-currency-dollar me-2"}),(e=t.price,new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(e))]}),r.jsx("div",{className:"mt-3 text-muted",dangerouslySetInnerHTML:{__html:t.description}})]}):"qa"===j?r.jsxs("div",{className:"p-4",children:[r.jsx("h5",{className:"fw-bold mb-3",children:"Q&A"}),r.jsx("div",{className:"mb-3",children:r.jsx("input",{className:"form-control",placeholder:"Search all course questions"})}),r.jsxs("div",{className:"d-flex flex-wrap gap-2 mb-3",children:[r.jsx("select",{className:"form-select w-auto",children:r.jsx("option",{children:"All lectures"})}),r.jsx("select",{className:"form-select w-auto",children:r.jsx("option",{children:"Sort by recommended"})}),r.jsx("button",{className:"btn btn-outline-primary",children:"Filter questions"})]}),r.jsxs("div",{className:"mt-4",children:[r.jsx("div",{className:"fw-bold mb-2",children:"All questions in this course (0)"}),r.jsx("div",{className:"text-muted",children:"No questions yet."})]})]}):"notes"===j?r.jsxs("div",{className:"p-4",children:[r.jsx("h5",{className:"fw-bold mb-3",children:"Notes"}),r.jsx("div",{className:"text-muted",children:"No notes yet."})]}):null;var e}})]}),r.jsx("div",{className:"col-lg-4 bg-light p-0",style:{minHeight:"100vh",position:"sticky",top:0,zIndex:2},children:r.jsx(m,{sections:t.sections,expandedSection:b,setExpandedSection:f,selectedLecture:p,setSelectedLecture:g,formatDuration:h,lectureProgressMap:y})})]})]})};export{x as default};
//# sourceMappingURL=Learning-ZzqDuc6d.js.map
